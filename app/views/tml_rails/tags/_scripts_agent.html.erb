<script>
    <%
        agent_host = Tml.config.agent[:host] || 'https://tools.translationexchange.com/agent/stable/agent.min.js'
        if Tml.config.agent[:cache]
          t = Time.now
          t = t - (t.to_i % Tml.config.agent[:cache].to_i).seconds
          agent_host += "?ts=#{t.to_i}"
        end

        agent_config = Tml.config.agent
        agent_config[:lanuages] = []
        tml_application.languages.each do |lang|
          agent_config[:lanuages] << {
              locale: lang.locale,
              english_name: lang.english_name,
              native_name: lang.native_name,
              flag_url: lang.flag_url
           }
        end
    %>
    (function() {
        var script = window.document.createElement('script');
        script.setAttribute('id',       'tml-agent');
        script.setAttribute('type',     'application/javascript');
        script.setAttribute('src',      '<%= agent_host %>');
        script.setAttribute('charset',  'UTF-8');
        script.onload = function() {
            Trex.init("<%=tml_application.key%>", <%=agent_config.to_json.html_safe%>);
        };
        window.document.getElementsByTagName('head')[0].appendChild(script);
    })();
</script>